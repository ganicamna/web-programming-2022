<!DOCTYPE html>
<html lang="en" dir "ltr">
<!-- USER page content-->

<head>
  <meta charset="utf-8">
  <title>PhotograpyApp</title>
  <link href="css.bootstrap.min.css" rel="stylesheet">
  </head>

<body>
  <header>
    <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">Carousel</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
          <ul class="navbar-nav me-auto mb-2 mb-md-0">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="#">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Link</a>
            </li>
            <li class="nav-item">
              <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Disabled</a>
            </li>
          </ul>
          <form class="d-flex">
            <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-success" type="submit">Search</button>
          </form>
        </div>
      </div>
    </nav>
  </header>

  <main>
    <div class="container marketing" style="margin-top:100px;">
      <!-- Three columns of text below the carousel -->
      <div id="user-list" class="row">
        <div class="spinner-border" role="status">
          <span class="sr-only"></span>
        </div>
      </div><!-- /.row -->
    </div>

  </main>
</body>

<script src="js/jquery-3.6.0.min.js"></script>
<script src="js/bootstrap.bundle.min.js"></script>

<script>

  getUsers();

   function getUsers(){
     $.get("rest/users", function(data) {

       $("#user-list").html("");

       var html = "";
       for(let i = 0; i < data.length; i++){
         html += `
         <div class="col-lg-4">
           <h2>`+ data[i].name +`</h2>
           <p>`+ "Age: " + data[i].age + ". Registered: " + data[i].registered + ". Speciality: " + data[i].speciality`</p>
           <p>
             <button type="button" class="btn btn-primary user-button" onclick="showModal(`+data[i].id+`)" >
               Launch demo modal
             </button>
           </p>
         </div>`;
       }
       $("#user-list").html(html);
       console.log(data);
     });
   }

   function showEditModal(id){
     $('.user-button').attr('disabled', true);
     $.get('rest/users/'+id, function(data){
       console.log(data);
       $("#name").val(data.name);
       $("#age").val(data.age);
       $("#registered").val(data.registered);
       $("#speciality").val(data.speciality);
       $("#id").val(data.id);
       $("#exampleModal").modal("show");
       $('.user-button').attr('disabled', false);
     })
   }

   function updateUser(){
     $('.save-user-button').attr('disabled', true);
     var user = {};

     todo.name = $('#name').val();
     todo.age = $('#age').val();
     todo.registered = $('#registered').val();
     todo.speciality = $('#speciality').val();

     $.ajax({
       url: 'rest/users/'+$('#id').val(),
       type: 'PUT',
       data: JSON.stringify(user),
       contentType: "application/json",
       dataType: "json",
       success: function(result) {
           $("#exampleModal").modal("hide");
           $('.save-user-button').attr('disabled', false);
           $("#user-list").html('<div class="spinner-border" role="status"> <span class="sr-only"></span>  </div>');
           getUsers(); // perf optimization
           console.log(result);
       }
     });

     console.log(user);
   }

   function deleteUser(id){
     $.ajax({
    url: '/script.cgi',
    type: 'DELETE',
    success: function(result) {
        // Do something with the result
    }
});
   }


 </script>

 <!-- Modal -->
 <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
   <div class="modal-dialog">
     <div class="modal-content">
       <div class="modal-header">
         <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
         <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
       </div>
       <div class="modal-body">
         <input id="id" type="hidden" />
         <input id="description" type="text" />
         <input id="created" type="hidden" />
       </div>
       <div class="modal-footer">
         <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
         <button type="button" class="btn btn-primary save-todo-button" onclick="saveTodo()">Save changes</button>
       </div>
     </div>
   </div>
 </div>

</html>
